<!--
Chat-style testing UI in pure HTML, CSS, and JavaScript (no frameworks)

How to use:
- Save this file as index.html and open in your browser.
- Replace the `webhookUrl` value with your n8n webhook.
- Sends POST request with { message, metadata }.
- If you need custom headers or authentication, edit the fetch call.
- CORS must be enabled on your webhook for local testing.
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Test UI — n8n</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f9fafb; display: flex; justify-content: center; padding: 20px; }
    .chat-container { width: 100%; max-width: 900px; background: white; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: grid; grid-template-rows: auto 1fr auto; height: 90vh; overflow: hidden; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid #ddd; }
    header input { width: 300px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }
    header button { padding: 5px 10px; margin-left: 5px; font-size: 12px; cursor: pointer; border: none; border-radius: 4px; }
    .messages { padding: 15px; overflow-y: auto; background: #fdfdfd; }
    .msg { max-width: 70%; padding: 10px; border-radius: 12px; margin-bottom: 10px; word-wrap: break-word; font-size: 14px; }
    .user { background: #dcf8c6; margin-left: auto; border-bottom-right-radius: 2px; }
    .bot { background: #eee; margin-right: auto; border-bottom-left-radius: 2px; }
    .system { background: #fff3cd; margin: auto; text-align: center; }
    .timestamp { font-size: 10px; color: #666; margin-top: 4px; }
    .typing { background: #eee; padding: 10px; border-radius: 12px; display: inline-block; }
    .input-area { display: flex; padding: 10px; border-top: 1px solid #ddd; }
    .input-area input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; }
    .input-area button { margin-left: 10px; padding: 10px 20px; border: none; border-radius: 20px; background: #25d366; color: white; cursor: pointer; }
    aside { width: 300px; margin-left: 20px; font-size: 12px; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 6px; overflow: auto; }
    @media (max-width: 900px) { aside { display: none; } }
  </style>
</head>
<body>

<div class="chat-container">
  <header>
    <div>
      <strong>Test Chat — n8n Webhook</strong><br>
      <span style="font-size:12px;color:#666;">Simula interface tipo WhatsApp/ChatGPT</span>
    </div>
    <div>
      <input id="webhook" value="https://pedrohen.app.n8n.cloud/webhook/7e358e31-9ff3-45ed-ba40-e93c0a2ec920" />
      <button onclick="copyWebhook()">Copiar</button>
      <button onclick="clearChat()" style="background:#fdd;">Limpar</button>
    </div>
  </header>

  <div id="messages" class="messages"></div>

  <form id="chatForm" class="input-area">
    <input id="chatInput" placeholder="Escreva uma mensagem..." autocomplete="off" />
    <button type="submit">Enviar</button>
  </form>
</div>

<aside>
  <h3>Última resposta (raw)</h3>
  <pre id="lastResponse">Nenhuma resposta ainda</pre>
  <h4>Payload enviado</h4>
  <pre>{
  "message": "texto enviado",
  "metadata": {
    "channel": "web-chat-ui",
    "userId": "test-user-123"
  }
}</pre>
</aside>

<script>
  const messagesDiv = document.getElementById('messages');
  const input = document.getElementById('chatInput');
  const form = document.getElementById('chatForm');
  const lastResponsePre = document.getElementById('lastResponse');
  const webhookInput = document.getElementById('webhook');

  function addMessage(role, text) {
    const div = document.createElement('div');
    div.className = 'msg ' + role;
    div.innerHTML = `<div>${text}</div><div class="timestamp">${new Date().toLocaleTimeString()}</div>`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function addTyping() {
    const div = document.createElement('div');
    div.className = 'msg bot typing';
    div.id = 'typingIndicator';
    div.textContent = '● ● ●';
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function removeTyping() {
    const typing = document.getElementById('typingIndicator');
    if (typing) typing.remove();
  }

  async function sendMessage(message) {
    addMessage('user', message);
    addTyping();

    const payload = {
      message,
      metadata: {
        channel: 'web-chat-ui',
        userId: 'test-user-123',
        time: new Date().toISOString()
      }
    };

    try {
      const res = await fetch(webhookInput.value, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const ct = res.headers.get('content-type') || '';
      let data;
      if (ct.includes('application/json')) data = await res.json();
      else data = await res.text();

      lastResponsePre.textContent = JSON.stringify({status: res.status, body: data}, null, 2);

      let botText = '';
      if (!data) botText = `(webhook ${res.status} vazio)`;
      else if (typeof data === 'string') botText = data;
      else if (data.reply) botText = data.reply;
      else if (data.message) botText = data.message;
      else if (Array.isArray(data) && data[0]?.text) botText = data[0].text;
      else botText = JSON.stringify(data);

      removeTyping();
      addMessage('bot', botText);
    } catch (err) {
      removeTyping();
      addMessage('system', 'Erro: ' + err.message);
      lastResponsePre.textContent = err.toString();
    }
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;
    input.value = '';
    sendMessage(text);
  });

  function copyWebhook() {
    navigator.clipboard.writeText(webhookInput.value);
  }
  function clearChat() {
    messagesDiv.innerHTML = '';
    lastResponsePre.textContent = 'Nenhuma resposta ainda';
  }
</script>

</body>
</html>
